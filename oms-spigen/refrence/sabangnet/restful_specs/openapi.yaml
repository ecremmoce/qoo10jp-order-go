openapi: 3.0.0
info:
  title: Acsell Fulfillment API (Sabangnet Compatible)
  version: 1.0.0
  description: |
    Shopee 주문정보를 Spigen WMS로 전송하는 RESTful API
    
    ## 개요
    - 사방넷 API의 XML 기반 구조를 JSON RESTful API로 현대화
    - Shopee 등 해외 쇼핑몰 주문 정보를 수집하여 풀필먼트 센터로 전송
    - 주문/송장/클레임 관리 핵심 기능 제공
    
    ## 주요 변경사항
    - XML → JSON 형식
    - GET 방식 URL 파라미터 → RESTful HTTP Methods
    - HEADER 노드 → HTTP Authorization Headers
    - CDATA 제거 및 타입 안정성 강화
    - ISO 8601 날짜 형식 지원
    
  contact:
    name: Acsell API Support
    email: api@acsell.co.kr
  license:
    name: Proprietary

servers:
  - url: https://api.acsell.co.kr/v1
    description: Production Server
  - url: https://api-staging.acsell.co.kr/v1
    description: Staging Server
  - url: http://localhost:3000/v1
    description: Local Development

security:
  - bearerAuth: []
  - companyId: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        사방넷의 SEND_AUTH_KEY에 해당하는 인증 토큰
        
        사방넷 원본:
        ```xml
        <SEND_AUTH_KEY>인증키</SEND_AUTH_KEY>
        ```
        
        RESTful 변환:
        ```
        Authorization: Bearer {API_KEY}
        ```
    
    companyId:
      type: apiKey
      in: header
      name: X-Company-ID
      description: |
        사방넷의 SEND_COMPAYNY_ID에 해당하는 회사 식별자
        
        사방넷 원본:
        ```xml
        <SEND_COMPAYNY_ID>아이디</SEND_COMPAYNY_ID>
        ```
        
        RESTful 변환:
        ```
        X-Company-ID: {COMPANY_ID}
        ```

  schemas:
    # 공통 응답 스키마
    SuccessResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: 처리가 완료되었습니다
        data:
          type: object
          description: 응답 데이터

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              example: INVALID_REQUEST
            message:
              type: string
              example: 잘못된 요청입니다
            details:
              type: object
              description: 추가 오류 상세 정보

    # 주문 수집 스키마
    OrderCollectRequest:
      type: object
      required:
        - startDate
        - endDate
        - outputFields
      properties:
        startDate:
          type: string
          format: date
          description: |
            검색 시작일자 (사방넷 주문 수집일 기준)
            
            사방넷 원본: ORD_ST_DATE (YYYYMMDD)
          example: "2025-10-01"
        endDate:
          type: string
          format: date
          description: |
            검색 종료일자 (사방넷 주문 수집일 기준)
            
            사방넷 원본: ORD_ED_DATE (YYYYMMDD)
          example: "2025-10-16"
        outputFields:
          type: array
          items:
            type: string
          description: |
            출력할 필드 목록
            
            사방넷 원본: ORD_FIELD (파이프 구분자 사용)
          example: ["orderId", "orderDate", "productName", "quantity", "price"]
        settlementConfirmed:
          type: string
          enum: ["Y", "N", "ALL"]
          description: |
            정산대조확인여부
            - Y: 확인완료
            - N: 미확인
            - ALL: 전체
            
            사방넷 원본: JUNG_CHK_YN2
          example: "ALL"
        orderId:
          type: string
          description: |
            쇼핑몰 주문번호 (특정 주문 조회 시)
            
            사방넷 원본: ORDER_ID
          example: "SHOP-2025-001"
        mallId:
          type: string
          description: |
            쇼핑몰 코드 (shop 또는 chop으로 시작)
            
            사방넷 원본: MALL_ID
          example: "shop001"
        orderStatus:
          type: string
          description: |
            주문 상태 코드
            
            사방넷 원본: ORDER_STATUS
          example: "01"
        partnerId:
          type: string
          description: |
            매입처 ID
            
            사방넷 원본: PARTNER_ID
        mallUserId:
          type: string
          description: |
            쇼핑몰 로그인 ID
            
            사방넷 원본: MALL_USER_ID
        logisticsId:
          type: string
          description: |
            물류처 ID
            
            사방넷 원본: DPARTNER_ID
        accountSerial:
          type: string
          description: |
            계정등록순번
            
            사방넷 원본: ACNT_REGS_SRNO

    OrderItem:
      type: object
      properties:
        orderId:
          type: string
          description: 주문번호 (사방넷)
        shopOrderId:
          type: string
          description: 주문번호 (쇼핑몰)
        mallName:
          type: string
          description: 쇼핑몰명
        orderDate:
          type: string
          format: date-time
          description: 주문일시
        orderStatus:
          type: string
          description: 주문상태
        productName:
          type: string
          description: 상품명
        quantity:
          type: integer
          description: 수량
        unitPrice:
          type: number
          description: 단가
        totalPrice:
          type: number
          description: 총금액
        recipientName:
          type: string
          description: 수취인명
        recipientPhone:
          type: string
          description: 수취인 전화번호
        address:
          type: string
          description: 배송주소
        zipCode:
          type: string
          description: 우편번호
        deliveryMessage:
          type: string
          description: 배송메시지

    OrderCollectResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                totalCount:
                  type: integer
                  description: 총 주문 건수
                  example: 150
                orders:
                  type: array
                  items:
                    $ref: '#/components/schemas/OrderItem'

    # 송장 등록 스키마
    InvoiceRegisterRequest:
      type: object
      required:
        - orderId
        - courierCode
        - trackingNumber
      properties:
        orderId:
          type: string
          description: |
            주문번호 (사방넷)
            
            사방넷 원본: SABANGNET_IDX
          example: "SB2025001"
        courierCode:
          type: string
          description: |
            택배사 코드
            
            사방넷 원본: TAK_CODE
            
            주요 택배사 코드:
            - CJ대한통운: 01
            - 우체국택배: 02
            - 한진택배: 03
            - 롯데택배: 04
            - 로젠택배: 05
          example: "01"
        trackingNumber:
          type: string
          description: |
            송장번호
            
            사방넷 원본: TAK_INVOICE
          example: "123456789012"
        deliveryHopeDate:
          type: string
          format: date
          description: |
            배송희망일자
            
            사방넷 원본: DELV_HOPE_DATE
          example: "2025-10-20"
        forceUpdate:
          type: boolean
          description: |
            출고대기 상태 송장정보 강제 수정 여부
            
            사방넷 원본: SEND_INV_EDIT_YN (Y/N)
          default: false

    InvoiceRegisterResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                orderId:
                  type: string
                  example: "SB2025001"
                courierCode:
                  type: string
                  example: "01"
                trackingNumber:
                  type: string
                  example: "123456789012"
                registeredAt:
                  type: string
                  format: date-time
                  example: "2025-10-16T15:30:00Z"

    # 클레임 수집 스키마
    ClaimCollectRequest:
      type: object
      required:
        - startDate
        - endDate
        - outputFields
      properties:
        startDate:
          type: string
          format: date
          description: |
            검색 시작일자 (클레임 수집일 기준)
            
            사방넷 원본: CLM_ST_DATE (YYYYMMDD)
          example: "2025-10-01"
        endDate:
          type: string
          format: date
          description: |
            검색 종료일자 (클레임 수집일 기준)
            
            사방넷 원본: CLM_ED_DATE (YYYYMMDD)
          example: "2025-10-16"
        outputFields:
          type: array
          items:
            type: string
          description: |
            출력할 필드 목록
            
            사방넷 원본: CLM_FIELD (파이프 구분자 사용)
          example: ["claimId", "claimType", "claimDate", "orderId", "productName"]

    ClaimItem:
      type: object
      properties:
        claimId:
          type: string
          description: 클레임 번호
        orderId:
          type: string
          description: 주문번호
        shopOrderId:
          type: string
          description: 쇼핑몰 주문번호
        claimType:
          type: string
          enum: ["CANCEL", "RETURN", "EXCHANGE"]
          description: |
            클레임 유형
            - CANCEL: 취소
            - RETURN: 반품
            - EXCHANGE: 교환
        claimReason:
          type: string
          description: 클레임 사유
        claimDate:
          type: string
          format: date-time
          description: 클레임 접수일시
        collectedDate:
          type: string
          format: date-time
          description: 사방넷 수집일시
        productName:
          type: string
          description: 상품명
        quantity:
          type: integer
          description: 수량
        claimAmount:
          type: number
          description: 클레임 금액

    ClaimCollectResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                totalCount:
                  type: integer
                  description: 총 클레임 건수
                  example: 25
                claims:
                  type: array
                  items:
                    $ref: '#/components/schemas/ClaimItem'

  responses:
    UnauthorizedError:
      description: 인증 실패
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: UNAUTHORIZED
              message: 인증 토큰이 유효하지 않습니다

    BadRequestError:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: INVALID_REQUEST
              message: 필수 파라미터가 누락되었습니다
              details:
                field: startDate
                reason: 시작일자는 필수입니다

    InternalServerError:
      description: 서버 오류
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: INTERNAL_ERROR
              message: 서버 내부 오류가 발생했습니다

paths:
  /orders/collect:
    post:
      tags:
        - Orders
      summary: 주문 정보 수집
      description: |
        사방넷에 수집된 주문 데이터를 가져옵니다.
        
        ## 사방넷 원본 API
        - URL: `https://sbadminXX.sabangnet.co.kr/RTL_API/xml_order_info.html?xml_url=xml주소`
        - Method: GET (XML URL 파라미터)
        - Format: XML
        
        ## 주요 변경사항
        - XML → JSON
        - GET → POST
        - 날짜 형식: YYYYMMDD → ISO 8601 (YYYY-MM-DD)
        - 배열 구분자: 파이프(|) → JSON Array
        
        ## 주의사항
        - API 요청 시 신규주문이 주문확인 상태로 변경됩니다
        - 중복 체크 작업이 필요합니다
        - 수취인명, 우편번호, 주소, 주문번호 오름차순 정렬
      operationId: collectOrders
      security:
        - bearerAuth: []
          companyId: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderCollectRequest'
            examples:
              basic:
                summary: 기본 주문 수집
                value:
                  startDate: "2025-10-01"
                  endDate: "2025-10-16"
                  outputFields: ["orderId", "orderDate", "productName", "quantity", "price"]
              withFilters:
                summary: 필터 조건 포함
                value:
                  startDate: "2025-10-01"
                  endDate: "2025-10-16"
                  outputFields: ["orderId", "orderDate", "productName"]
                  mallId: "shop001"
                  orderStatus: "01"
                  settlementConfirmed: "Y"
      responses:
        '200':
          description: 주문 수집 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderCollectResponse'
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    message: 주문 수집이 완료되었습니다
                    data:
                      totalCount: 150
                      orders:
                        - orderId: "SB2025001"
                          shopOrderId: "SHOP-2025-001"
                          mallName: "Shopee Singapore"
                          orderDate: "2025-10-15T10:30:00Z"
                          orderStatus: "주문확인"
                          productName: "스마트폰 케이스"
                          quantity: 2
                          unitPrice: 15000
                          totalPrice: 30000
                          recipientName: "홍길동"
                          recipientPhone: "010-1234-5678"
                          address: "서울시 강남구 테헤란로 123"
                          zipCode: "06234"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /invoices:
    post:
      tags:
        - Invoices
      summary: 송장 정보 등록
      description: |
        주문에 송장번호와 택배사 정보를 등록합니다.
        
        ## 사방넷 원본 API
        - URL: `https://sbadminXX.sabangnet.co.kr/RTL_API/xml_order_invoice.html?xml_url=xml주소`
        - Method: GET (XML URL 파라미터)
        - Format: XML
        
        ## 주요 변경사항
        - XML → JSON
        - GET → POST
        - 날짜 형식: YYYYMMDD → ISO 8601 (YYYY-MM-DD)
        
        ## 주의사항
        - 주문확인 상태 → 송장 입력 시 출고대기로 변경
        - 출고대기 상태에서 송장 전송 완료된 경우 수정 불가
        - 강제완료 상태는 수정 불가
      operationId: registerInvoice
      security:
        - bearerAuth: []
          companyId: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvoiceRegisterRequest'
            examples:
              basic:
                summary: 기본 송장 등록
                value:
                  orderId: "SB2025001"
                  courierCode: "01"
                  trackingNumber: "123456789012"
              withDeliveryDate:
                summary: 배송희망일 포함
                value:
                  orderId: "SB2025001"
                  courierCode: "01"
                  trackingNumber: "123456789012"
                  deliveryHopeDate: "2025-10-20"
              forceUpdate:
                summary: 강제 수정
                value:
                  orderId: "SB2025001"
                  courierCode: "01"
                  trackingNumber: "123456789012"
                  forceUpdate: true
      responses:
        '200':
          description: 송장 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoiceRegisterResponse'
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    message: 송장이 등록되었습니다
                    data:
                      orderId: "SB2025001"
                      courierCode: "01"
                      trackingNumber: "123456789012"
                      registeredAt: "2025-10-16T15:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /claims/collect:
    post:
      tags:
        - Claims
      summary: 클레임 정보 수집
      description: |
        취소/반품/교환 등 클레임 데이터를 수집합니다.
        
        ## 사방넷 원본 API
        - URL: `https://sbadminXX.sabangnet.co.kr/RTL_API/xml_clm_info.html?xml_url=xml주소`
        - Method: GET (XML URL 파라미터)
        - Format: XML
        
        ## 주요 변경사항
        - XML → JSON
        - GET → POST
        - 날짜 형식: YYYYMMDD → ISO 8601 (YYYY-MM-DD)
        - 배열 구분자: 파이프(|) → JSON Array
        
        ## 주의사항
        - 자동 수집된 클레임만 조회 가능
        - 수동 입력 클레임은 조회되지 않음
        - 중복 체크 작업 필요
      operationId: collectClaims
      security:
        - bearerAuth: []
          companyId: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimCollectRequest'
            examples:
              basic:
                summary: 기본 클레임 수집
                value:
                  startDate: "2025-10-01"
                  endDate: "2025-10-16"
                  outputFields: ["claimId", "claimType", "claimDate", "orderId", "productName"]
      responses:
        '200':
          description: 클레임 수집 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimCollectResponse'
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    message: 클레임 수집이 완료되었습니다
                    data:
                      totalCount: 25
                      claims:
                        - claimId: "CLM2025001"
                          orderId: "SB2025001"
                          shopOrderId: "SHOP-2025-001"
                          claimType: "RETURN"
                          claimReason: "단순변심"
                          claimDate: "2025-10-15T14:20:00Z"
                          collectedDate: "2025-10-15T14:25:00Z"
                          productName: "스마트폰 케이스"
                          quantity: 1
                          claimAmount: 15000
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

tags:
  - name: Orders
    description: 주문 관리 API
  - name: Invoices
    description: 송장 관리 API
  - name: Claims
    description: 클레임 관리 API

